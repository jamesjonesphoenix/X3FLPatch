<?xml version="1.0" standalone="yes" ?>
<?xml-stylesheet href="x2script.xsl" type="text/xsl" ?>
<script>
<name>!move.movetostation.drone.check</name>
<version>1</version>
<engineversion>72</engineversion>
<description>Disables collision on drone when close to target ship.</description>
<arguments>
<argument index="1" name="target" type="Var/Ship" desc="" />
<argument index="2" name="range" type="Var/Number" desc="" />
<argument index="3" name="task" type="Var/Number" desc="task assigned to movetoposition" />
</arguments>
<sourceplaintext>
<![CDATA[
  skip if $target
    return null
  
  if [OWNER] == Player
    $debug = 9595
    $id = [THIS] -> get ID code
    $prepend = sprintf: fmt='Docking "%s ID: %s" to "%s" -', [THIS], $id, $target, null, null
  end
  
  $waitActive = 1000
  $wait = $waitActive
  
  while [THIS] -> exists
@   = wait $wait ms
    skip if $target -> exists
      break
    skip if $target -> is docking possible of [THIS]
      break
    skip if [THIS] -> is docking allowed at $target
      break
    skip if [THIS] -> is script !move.movetostation.drone on stack of task=0
      break
    
    if not [THIS] -> is in active sector
      $wait = 60000
      continue
    else if not $target -> is in active sector
      $wait = 60000
      continue
    end
    $wait = $waitActive
    
    $dist = get distance between [THIS] and $target
    if $dist < $range
      if not [THIS] -> find nearest enemy ship: max.dist=10000
        [THIS] ->ignore collisions: [TRUE]
        write to log file #$debug  append=[TRUE]  printf: fmt='%s Ignoring Collisions', $prepend, null, null, null, null
        continue
      end
    end
    
    [THIS] ->ignore collisions: [FALSE]
    write to log file #$debug  append=[TRUE]  printf: fmt='%s Not Ignoring Collisions', $prepend, null, null, null, null
    
  end
  
@ = wait 500 ms
  [THIS] ->ignore collisions: [FALSE]
  do if [THIS] -> is script !move.movetopositioncontinue on stack of task=$task
    [THIS] ->start task $task with script !lib.interrupt and prio 100: arg1=null arg2=null arg3=null arg4=null arg5=null
  
  return null
]]>
</sourceplaintext>
<sourcetext>
<line indent=""><var>skip&#160;if&#160;</var><var>$target</var></line>
<line indent="&#160;"><text>return&#160;</text><var>null</var></line>
<line indent=""></line>
<line indent=""><var>if&#160;</var><var>[OWNER]</var><text>&#160;</text><var>==</var><text>&#160;</text><var>Player</var></line>
<line indent="&#160;"><var>$debug&#160;=&#160;</var><var>9595</var></line>
<line indent="&#160;"><var>$id&#160;=&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;get&#160;ID&#160;code</text></line>
<line indent="&#160;"><var>$prepend&#160;=&#160;</var><text>sprintf:&#160;fmt=</text><var>'Docking&#160;&quot;%s&#160;ID:&#160;%s&quot;&#160;to&#160;&quot;%s&quot;&#160;-'</var><text>,&#160;</text><var>[THIS]</var><text>,&#160;</text><var>$id</var><text>,&#160;</text><var>$target</var><text>,&#160;</text><var>null</var><text>,&#160;</text><var>null</var></line>
<line indent=""><text>end</text></line>
<line indent=""></line>
<line indent=""><var>$waitActive&#160;=&#160;</var><var>1000</var></line>
<line indent=""><var>$wait&#160;=&#160;</var><var>$waitActive</var></line>
<line indent=""></line>
<line indent=""><var>while&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;exists</text></line>
<line interruptable="@" indent="&#160;"><var>=&#160;</var><text>wait&#160;</text><var>$wait</var><text>&#160;ms</text></line>
<line indent="&#160;"><var>skip&#160;if&#160;</var><var>$target&#160;-&gt;</var><text>&#160;exists</text></line>
<line indent="&#160;&#160;"><text>break</text></line>
<line indent="&#160;"><var>skip&#160;if&#160;</var><var>$target&#160;-&gt;</var><text>&#160;is&#160;docking&#160;possible&#160;of&#160;</text><var>[THIS]</var></line>
<line indent="&#160;&#160;"><text>break</text></line>
<line indent="&#160;"><var>skip&#160;if&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;is&#160;docking&#160;allowed&#160;at&#160;</text><var>$target</var></line>
<line indent="&#160;&#160;"><text>break</text></line>
<line indent="&#160;"><var>skip&#160;if&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;is&#160;script&#160;</text><call>!move.movetostation.drone</call><text>&#160;on&#160;stack&#160;of&#160;task=</text><var>0</var></line>
<line indent="&#160;&#160;"><text>break</text></line>
<line indent="&#160;"></line>
<line indent="&#160;"><var>if&#160;not&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;is&#160;in&#160;active&#160;sector</text></line>
<line indent="&#160;&#160;"><var>$wait&#160;=&#160;</var><var>60000</var></line>
<line indent="&#160;&#160;"><text>continue</text></line>
<line indent="&#160;"><var>else&#160;if&#160;not&#160;</var><var>$target&#160;-&gt;</var><text>&#160;is&#160;in&#160;active&#160;sector</text></line>
<line indent="&#160;&#160;"><var>$wait&#160;=&#160;</var><var>60000</var></line>
<line indent="&#160;&#160;"><text>continue</text></line>
<line indent="&#160;"><text>end</text></line>
<line indent="&#160;"><var>$wait&#160;=&#160;</var><var>$waitActive</var></line>
<line indent="&#160;"></line>
<line indent="&#160;"><var>$dist&#160;=&#160;</var><text>get&#160;distance&#160;between&#160;</text><var>[THIS]</var><text>&#160;and&#160;</text><var>$target</var></line>
<line indent="&#160;"><var>if&#160;</var><var>$dist</var><text>&#160;</text><var>&lt;</var><text>&#160;</text><var>$range</var></line>
<line indent="&#160;&#160;"><var>if&#160;not&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;find&#160;nearest&#160;enemy&#160;ship:&#160;max.dist=</text><var>10000</var></line>
<line indent="&#160;&#160;&#160;"><var>[THIS]&#160;-&gt;</var><text>ignore&#160;collisions:&#160;</text><var>[TRUE]</var></line>
<line indent="&#160;&#160;&#160;"><text>write&#160;to&#160;log&#160;file&#160;#</text><var>$debug</var><text>&#160;&#160;append=</text><var>[TRUE]</var><text>&#160;&#160;printf:&#160;fmt=</text><var>'%s&#160;Ignoring&#160;Collisions'</var><text>,&#160;</text><var>$prepend</var><text>,&#160;</text><var>null</var><text>,&#160;</text><var>null</var><text>,&#160;</text><var>null</var><text>,&#160;</text><var>null</var></line>
<line indent="&#160;&#160;&#160;"><text>continue</text></line>
<line indent="&#160;&#160;"><text>end</text></line>
<line indent="&#160;"><text>end</text></line>
<line indent="&#160;"></line>
<line indent="&#160;"><var>[THIS]&#160;-&gt;</var><text>ignore&#160;collisions:&#160;</text><var>[FALSE]</var></line>
<line indent="&#160;"><text>write&#160;to&#160;log&#160;file&#160;#</text><var>$debug</var><text>&#160;&#160;append=</text><var>[TRUE]</var><text>&#160;&#160;printf:&#160;fmt=</text><var>'%s&#160;Not&#160;Ignoring&#160;Collisions'</var><text>,&#160;</text><var>$prepend</var><text>,&#160;</text><var>null</var><text>,&#160;</text><var>null</var><text>,&#160;</text><var>null</var><text>,&#160;</text><var>null</var></line>
<line indent="&#160;"></line>
<line indent=""><text>end</text></line>
<line indent=""></line>
<line interruptable="@" indent=""><var>=&#160;</var><text>wait&#160;</text><var>500</var><text>&#160;ms</text></line>
<line indent=""><var>[THIS]&#160;-&gt;</var><text>ignore&#160;collisions:&#160;</text><var>[FALSE]</var></line>
<line indent=""><var>do&#160;if&#160;</var><var>[THIS]&#160;-&gt;</var><text>&#160;is&#160;script&#160;</text><call>!move.movetopositioncontinue</call><text>&#160;on&#160;stack&#160;of&#160;task=</text><var>$task</var></line>
<line indent="&#160;"><var>[THIS]&#160;-&gt;</var><text>start&#160;task&#160;</text><var>$task</var><text>&#160;with&#160;script&#160;</text><call>!lib.interrupt</call><text>&#160;and&#160;prio&#160;</text><var>100</var><text>:&#160;arg1=</text><var>null</var><text>&#160;arg2=</text><var>null</var><text>&#160;arg3=</text><var>null</var><text>&#160;arg4=</text><var>null</var><text>&#160;arg5=</text><var>null</var></line>
<line indent=""></line>
<line indent=""><text>return&#160;</text><var>null</var></line>
</sourcetext>
<codearray>

<sval type="array" size="10">
  <sval type="string" val="!move.movetostation.drone.check"/>
  <sval type="int" val="72"/>
  <sval type="string" val="Disables collision on drone when close to target ship."/>
  <sval type="int" val="1"/>
  <sval type="int" val="0"/>
  <sval type="array" size="9">
    <sval type="string" val="target"/>
    <sval type="string" val="range"/>
    <sval type="string" val="task"/>
    <sval type="string" val="debug"/>
    <sval type="string" val="id"/>
    <sval type="string" val="prepend"/>
    <sval type="string" val="waitActive"/>
    <sval type="string" val="wait"/>
    <sval type="string" val="dist"/>
  </sval>
  <sval type="array" size="40">
    <sval type="array" size="7">
      <sval type="int" val="104"/>
      <sval type="int" val="-536870393"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1"/>
    </sval>
    <sval type="array" size="3">
      <sval type="int" val="103"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="13">
      <sval type="int" val="104"/>
      <sval type="int" val="-1610611197"/>
      <sval type="int" val="3"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="7"/>
      <sval type="int" val="10"/>
      <sval type="int" val="10"/>
      <sval type="int" val="15"/>
      <sval type="int" val="0"/>
      <sval type="int" val="3"/>
      <sval type="int" val="-1"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-2"/>
    </sval>
    <sval type="array" size="7">
      <sval type="int" val="104"/>
      <sval type="int" val="3"/>
      <sval type="int" val="1"/>
      <sval type="int" val="4"/>
      <sval type="int" val="9595"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="1036"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="14">
      <sval type="int" val="149"/>
      <sval type="int" val="5"/>
      <sval type="int" val="5"/>
      <sval type="string" val="Docking &quot;%s ID: %s&quot; to &quot;%s&quot; -"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="4"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="7">
      <sval type="int" val="104"/>
      <sval type="int" val="6"/>
      <sval type="int" val="1"/>
      <sval type="int" val="4"/>
      <sval type="int" val="1000"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1"/>
    </sval>
    <sval type="array" size="7">
      <sval type="int" val="104"/>
      <sval type="int" val="7"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="6"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="706"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1610603767"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="105"/>
      <sval type="int" val="-2147483647"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="7"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="706"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-536867833"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="35"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="746"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-536867321"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="35"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="513"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-536866809"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="35"/>
    </sval>
    <sval type="array" size="7">
      <sval type="int" val="1072"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-536866297"/>
      <sval type="string" val="!move.movetostation.drone"/>
      <sval type="int" val="4"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="35"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="761"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-536865276"/>
    </sval>
    <sval type="array" size="7">
      <sval type="int" val="104"/>
      <sval type="int" val="7"/>
      <sval type="int" val="1"/>
      <sval type="int" val="4"/>
      <sval type="int" val="60000"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="8"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="25"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="761"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
      <sval type="int" val="-536864506"/>
    </sval>
    <sval type="array" size="7">
      <sval type="int" val="104"/>
      <sval type="int" val="7"/>
      <sval type="int" val="1"/>
      <sval type="int" val="4"/>
      <sval type="int" val="60000"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="8"/>
    </sval>
    <sval type="array" size="7">
      <sval type="int" val="104"/>
      <sval type="int" val="7"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="6"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="738"/>
      <sval type="int" val="8"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="13">
      <sval type="int" val="104"/>
      <sval type="int" val="-1610604541"/>
      <sval type="int" val="3"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="8"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="1"/>
      <sval type="int" val="15"/>
      <sval type="int" val="3"/>
      <sval type="int" val="3"/>
      <sval type="int" val="-1"/>
      <sval type="int" val="3"/>
      <sval type="int" val="-2"/>
    </sval>
    <sval type="array" size="6">
      <sval type="int" val="503"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-536862716"/>
      <sval type="int" val="4"/>
      <sval type="int" val="10000"/>
    </sval>
    <sval type="array" size="5">
      <sval type="int" val="1221"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="10"/>
    </sval>
    <sval type="array" size="17">
      <sval type="int" val="405"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="3"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="10"/>
      <sval type="int" val="5"/>
      <sval type="string" val="%s Ignoring Collisions"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="5"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="8"/>
    </sval>
    <sval type="array" size="5">
      <sval type="int" val="1221"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="9"/>
    </sval>
    <sval type="array" size="17">
      <sval type="int" val="405"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="3"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="10"/>
      <sval type="int" val="5"/>
      <sval type="string" val="%s Not Ignoring Collisions"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="5"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="112"/>
      <sval type="int" val="8"/>
    </sval>
    <sval type="array" size="4">
      <sval type="int" val="105"/>
      <sval type="int" val="-2147483647"/>
      <sval type="int" val="4"/>
      <sval type="int" val="500"/>
    </sval>
    <sval type="array" size="5">
      <sval type="int" val="1221"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="9"/>
    </sval>
    <sval type="array" size="7">
      <sval type="int" val="1072"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="int" val="-1610602744"/>
      <sval type="string" val="!move.movetopositioncontinue"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="18">
      <sval type="int" val="1017"/>
      <sval type="int" val="131075"/>
      <sval type="int" val="1"/>
      <sval type="string" val="!lib.interrupt"/>
      <sval type="int" val="131074"/>
      <sval type="int" val="2"/>
      <sval type="int" val="4"/>
      <sval type="int" val="100"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
    </sval>
    <sval type="array" size="3">
      <sval type="int" val="103"/>
      <sval type="int" val="0"/>
      <sval type="int" val="0"/>
    </sval>
  </sval>
  <sval type="array" size="3">
    <sval type="array" size="2">
      <sval type="int" val="21"/>
      <sval type="string" val=""/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="10"/>
      <sval type="string" val=""/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="10"/>
      <sval type="string" val="task assigned to movetoposition"/>
    </sval>
  </sval>
  <sval type="array" size="21">
    <sval type="array" size="2">
      <sval type="int" val="2"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="6"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="6"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="8"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="12"/>
      <sval type="int" val="7"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="14"/>
      <sval type="int" val="7"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="16"/>
      <sval type="int" val="7"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="18"/>
      <sval type="int" val="7"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="18"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="21"/>
      <sval type="int" val="6"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="25"/>
      <sval type="int" val="6"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="25"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="26"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="32"/>
      <sval type="int" val="6"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="32"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="32"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="32"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="34"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="35"/>
      <sval type="int" val="4"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="35"/>
      <sval type="int" val="2"/>
    </sval>
    <sval type="array" size="2">
      <sval type="int" val="39"/>
      <sval type="int" val="2"/>
    </sval>
  </sval>
  <sval type="int" val="0"/>
</sval>

</codearray>
<nosignature>7188</nosignature>
</script>
